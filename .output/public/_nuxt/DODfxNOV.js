import{r as Y,a as B,_ as ee}from"./BfEU15pp.js";import{_ as te}from"./DeMLfEu4.js";import{c as m,o as u,a as e,_ as se,i as x,y as ae,z as D,A as re,m as z,w as oe,k as _,g as a,l as le,B as ne,n as ie,t as i,b as g,x as R,j as O,C as T,F as j,s as $}from"./Cuvv8fMg.js";import{s as de}from"./x_rD_Ya3.js";import{r as ce}from"./BOs-63Ba.js";import{r as ue}from"./Chie5Ehj.js";import{r as me}from"./rWqD71tM.js";function E(A,p){return u(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"})])}function ge(A,p){return u(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function pe(A,p){return u(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m6.75 12-3-3m0 0-3 3m3-3v6m-1.5-15H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"})])}const fe={class:"space-y-6"},ve={class:"card p-6"},xe={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},_e={key:0,class:"flex space-x-4"},ye=["disabled"],be={key:0,class:"card p-8"},he={class:"text-center"},we={class:"mb-6"},ke={class:"space-y-4"},Ce={key:1,class:"card p-6"},Fe={class:"flex items-center space-x-4"},Ne={class:"flex-1"},De={class:"text-gray-400 text-sm"},Re={class:"w-full bg-gray-700 rounded-full h-2 mt-2"},je={class:"text-blue-400 text-sm"},$e={key:2,class:"card p-6 border-green-500/20 bg-green-500/5"},Ae={class:"flex items-center space-x-3"},Se={class:"text-gray-300 text-sm"},Be={key:3,class:"card p-6 border-red-500/20 bg-red-500/5"},Ee={class:"flex items-center space-x-3"},Ie={class:"text-gray-300 text-sm"},Le={key:4,class:"flex items-center justify-center py-12"},Ue={class:"text-center"},Pe={key:5,class:"card p-6 border-red-500/20 bg-red-500/5"},Me={class:"flex items-center space-x-3"},ze={class:"text-gray-300 text-sm"},Oe={key:6},Te={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"},Ve={class:"card p-6"},He={class:"flex items-center justify-between"},Ge={class:"text-2xl font-bold text-red-400"},We={class:"text-xs text-green-400"},Ze={class:"w-12 h-12 bg-red-500/20 rounded-lg flex items-center justify-center"},Je={class:"card p-6"},qe={class:"flex items-center justify-between"},Ke={class:"text-2xl font-bold text-blue-400"},Qe={class:"text-xs text-gray-400"},Xe={class:"w-12 h-12 bg-blue-500/20 rounded-lg flex items-center justify-center"},Ye={class:"card p-6"},et={class:"flex items-center justify-between"},tt={class:"text-xs text-red-400"},st={class:"w-12 h-12 bg-yellow-500/20 rounded-lg flex items-center justify-center"},at={class:"card p-6"},rt={class:"flex items-center justify-between"},ot={class:"text-2xl font-bold text-green-400"},lt={class:"w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center"},nt={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},it={class:"card p-6"},dt={class:"h-80"},ct={class:"card p-6"},ut={class:"h-80"},mt={class:"card p-6"},gt={class:"h-80"},pt={class:"card p-6"},ft={class:"space-y-4"},vt={class:"w-32 text-sm text-gray-300"},xt={class:"flex-1 mx-4"},_t={class:"w-full bg-gray-700 rounded-full h-3"},yt={class:"w-16 text-sm text-red-400 text-right"},bt={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},ht={class:"card p-6"},wt={class:"space-y-3"},kt={class:"w-6 h-6 bg-blue-500/20 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5"},Ct={class:"text-blue-400 text-xs font-bold"},Ft={class:"text-gray-300 text-sm"},Nt={class:"card p-6"},Dt={class:"space-y-4"},Rt={class:"font-medium text-white"},jt={class:"text-sm text-gray-400"},$t={class:"text-right"},At={class:"text-sm text-gray-400"},St={class:"card p-6"},Bt={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Et={class:"grid grid-cols-2 gap-4 text-sm"},It={class:"font-semibold text-white"},Lt={class:"font-semibold text-red-400"},Ut={class:"col-span-2"},Pt={__name:"analysis",setup(A){const p=x("30d"),o=x(null),y=x(!1),v=x(null),w=x(!1),b=x(null),l=x({processing:!1,completed:!1,error:null,progress:0,message:"",fileName:"",recordCount:0}),S=ae().public.apiBase||"http://localhost:8000",k=s=>s==null||s===""||isNaN(s)?"0":new Intl.NumberFormat().format(Number(s)),C=s=>s==null||s===""||isNaN(s)?"0.00":Number(s).toFixed(2),I=s=>s?s.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" "):"",V=s=>{var n,d;if(!((d=(n=o.value)==null?void 0:n.trends)!=null&&d.by_amount))return"0.00";const t=o.value.trends.by_amount[s];return!t||t.mean==null||isNaN(t.mean)?"0.00":(Number(t.mean)*100).toFixed(2)},H=()=>{var t;if(!((t=o.value)!=null&&t.fraud_statistics))return"0.0";const s=o.value.fraud_statistics;return!s.legitimate_transactions||!s.total_transactions?"0.0":(Number(s.legitimate_transactions)/Number(s.total_transactions)*100).toFixed(1)},L=s=>{const t=Number(s);return isNaN(t)?"text-gray-400":t>10?"text-red-400":t>5?"text-orange-400":t>1?"text-yellow-400":"text-green-400"},G=s=>{s.preventDefault(),w.value=!1;const t=s.dataTransfer.files;t.length>0&&U(t[0])},W=s=>{const t=s.target.files;t.length>0&&U(t[0])},U=async s=>{const t=[".csv",".xlsx",".xls"],n="."+s.name.split(".").pop().toLowerCase();if(!t.includes(n)){l.value.error="Invalid file format. Please upload a CSV or Excel file.";return}b.value=s,await Z(s)},Z=async s=>{var n,d,r,c;let t;try{l.value={processing:!0,completed:!1,error:null,progress:0,message:"Preparing file upload...",fileName:s.name,recordCount:0};const h=new FormData;h.append("file",s),t=de(()=>{l.value.progress<90&&(l.value.progress+=Math.random()*15,l.value.progress<25?l.value.message="Uploading file...":l.value.progress<50?l.value.message="Processing data...":l.value.progress<75?l.value.message="Analyzing patterns...":l.value.message="Generating insights...")},400);const F=await $fetch(`${S}/analyze`,{method:"POST",body:h});clearInterval(t),console.log("API Response:",F),console.log("Response structure:",Object.keys(F||{}));const f=F.data||F;console.log("Analysis data structure:",f),console.log("Fraud statistics:",f==null?void 0:f.fraud_statistics),l.value.progress=100,l.value.message="Analysis complete!",l.value.processing=!1,l.value.completed=!0,l.value.recordCount=F.record_count||((n=f==null?void 0:f.fraud_statistics)==null?void 0:n.total_transactions)||0,o.value=f,o.value&&(console.log("Final analysis data:",o.value),console.log("Fraud percentage type:",typeof((d=o.value.fraud_statistics)==null?void 0:d.fraud_percentage)),console.log("Fraud percentage value:",(r=o.value.fraud_statistics)==null?void 0:r.fraud_percentage))}catch(h){t&&clearInterval(t),console.error("Error uploading and analyzing file:",h),l.value.processing=!1,l.value.error=((c=h.data)==null?void 0:c.detail)||h.message||"Failed to upload and analyze file. Please try again."}},P=()=>{l.value={processing:!1,completed:!1,error:null,progress:0,message:"",fileName:"",recordCount:0},o.value=null,b.value=null,v.value=null},N=async()=>{if(!o.value){v.value="No data available. Please upload a file first.";return}try{y.value=!0,v.value=null;const s=new FormData;if(b.value){s.append("file",b.value),s.append("time_range",p.value);const t=await $fetch(`${S}/analyze`,{method:"POST",body:s});o.value=t.data||t}}catch(s){console.error("Error fetching analysis data:",s),v.value="Failed to refresh analysis data. Please try again."}finally{y.value=!1}},J=()=>{N()},q=async()=>{if(!b.value){v.value="No data available to export.";return}try{const s=new FormData;s.append("file",b.value),s.append("time_range",p.value),s.append("export_format","csv");const t=await $fetch(`${S}/analyze`,{method:"POST",body:s}),n=t.export_data||t,d=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),r=window.URL.createObjectURL(d),c=document.createElement("a");c.href=r,c.download=`fraud_analysis_${p.value}_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(r)}catch(s){console.error("Error exporting analysis:",s)}},K=D(()=>{var n,d;if(!((d=(n=o.value)==null?void 0:n.trends)!=null&&d.by_category))return null;const s=o.value.trends.by_category,t=Object.entries(s).filter(([,r])=>r&&r.mean!=null).sort(([,r],[,c])=>Number(c.mean)-Number(r.mean)).slice(0,10);return{labels:t.map(([r])=>I(r)),datasets:[{label:"Fraud Rate (%)",data:t.map(([,r])=>(Number(r.mean)*100).toFixed(3)),backgroundColor:"rgba(239, 68, 68, 0.8)",borderColor:"#EF4444",borderWidth:1}]}}),Q=D(()=>{var n,d;if(!((d=(n=o.value)==null?void 0:n.trends)!=null&&d.by_amount))return null;const s=o.value.trends.by_amount,t=["0-50","51-100","101-500","501-1000","1000+"];return{labels:t.map(r=>`$${r}`),datasets:[{label:"Fraud Rate (%)",data:t.map(r=>{const c=s[r];return c&&c.mean!=null?(Number(c.mean)*100).toFixed(3):"0"}),borderColor:"#F59E0B",backgroundColor:"rgba(245, 158, 11, 0.1)",tension:.4,fill:!0}]}}),X=D(()=>{var t,n,d,r;if(!((n=(t=o.value)==null?void 0:t.trends)!=null&&n.by_gender))return null;const s=o.value.trends.by_gender;return{labels:["Female","Male"],datasets:[{data:[((d=s.F)==null?void 0:d.sum)||0,((r=s.M)==null?void 0:r.sum)||0],backgroundColor:["#EC4899","#3B82F6"],borderWidth:0}]}}),M=D(()=>{var s,t;return(t=(s=o.value)==null?void 0:s.trends)!=null&&t.by_category?Object.entries(o.value.trends.by_category).filter(([,n])=>n&&n.mean!=null).map(([n,d])=>({name:n,fraud_rate:Number(d.mean),fraud_cases:d.sum||0,total_transactions:d.count||0})).sort((n,d)=>d.fraud_rate-n.fraud_rate).slice(0,8):[]});return re(p,()=>{o.value&&N()}),(s,t)=>{const n=ee,d=te;return u(),z(d,{name:"default"},{default:oe(()=>[e("div",fe,[e("div",ve,[e("div",xe,[t[7]||(t[7]=e("h2",{class:"text-xl font-semibold text-white"},"Data Analysis & Visualization",-1)),a(o)?(u(),m("div",_e,[le(e("select",{"onUpdate:modelValue":t[0]||(t[0]=r=>ne(p)?p.value=r:null),onChange:N,class:"input-field"},t[6]||(t[6]=[e("option",{value:"7d"},"Last 7 days",-1),e("option",{value:"30d"},"Last 30 days",-1),e("option",{value:"90d"},"Last 90 days",-1),e("option",{value:"1y"},"Last year",-1)]),544),[[ie,a(p)]]),e("button",{onClick:J,disabled:a(y),class:"btn-primary flex items-center space-x-2"},[a(y)?(u(),z(a(E),{key:0,class:"w-4 h-4 animate-spin"})):_("",!0),e("span",null,i(a(y)?"Refreshing...":"Refresh Data"),1)],8,ye),e("button",{onClick:q,class:"btn-primary"},"Export Analysis")])):_("",!0)])]),a(o)?_("",!0):(u(),m("div",be,[e("div",he,[e("div",we,[g(a(pe),{class:"w-16 h-16 text-blue-400 mx-auto mb-4"}),t[8]||(t[8]=e("h3",{class:"text-xl font-semibold text-white mb-2"},"Upload Data File",-1)),t[9]||(t[9]=e("p",{class:"text-gray-400"},"Upload a CSV file to begin your fraud detection analysis",-1))]),e("div",{onDrop:G,onDragover:t[2]||(t[2]=O(()=>{},["prevent"])),onDragenter:[t[3]||(t[3]=O(()=>{},["prevent"])),t[4]||(t[4]=r=>w.value=!0)],class:R(["border-2 border-dashed border-gray-600 rounded-lg p-8 mb-4 transition-colors",{"border-blue-500 bg-blue-500/5":a(w),"hover:border-gray-500 hover:bg-gray-700/20":!a(w)}]),onDragleave:t[5]||(t[5]=r=>w.value=!1)},[e("div",ke,[g(a(ce),{class:"w-12 h-12 text-gray-400 mx-auto"}),t[10]||(t[10]=e("div",null,[e("p",{class:"text-white font-medium"},"Drop your CSV file here"),e("p",{class:"text-gray-400 text-sm"},"or click to browse")],-1)),e("input",{ref:"fileInput",type:"file",accept:".csv,.xlsx,.xls",onChange:W,class:"hidden"},null,544),e("button",{onClick:t[1]||(t[1]=r=>s.$refs.fileInput.click()),class:"btn-primary"}," Choose File ")])],34)])])),a(l).processing?(u(),m("div",Ce,[e("div",Fe,[g(a(E),{class:"w-6 h-6 animate-spin text-blue-400"}),e("div",Ne,[t[11]||(t[11]=e("h3",{class:"text-white font-medium"},"Processing File",-1)),e("p",De,i(a(l).message),1),e("div",Re,[e("div",{class:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:T({width:a(l).progress+"%"})},null,4)])]),e("span",je,i(a(l).progress)+"%",1)])])):_("",!0),a(l).completed&&!a(l).error?(u(),m("div",$e,[e("div",Ae,[g(a(Y),{class:"w-6 h-6 text-green-400"}),e("div",null,[t[12]||(t[12]=e("h3",{class:"text-green-400 font-semibold"},"File Uploaded Successfully",-1)),e("p",Se,i(a(l).fileName)+" - "+i(k(a(l).recordCount))+" records processed",1)]),e("button",{onClick:P,class:"btn-secondary text-sm ml-auto"}," Upload New File ")])])):_("",!0),a(l).error?(u(),m("div",Be,[e("div",Ee,[g(a(B),{class:"w-6 h-6 text-red-400"}),e("div",null,[t[13]||(t[13]=e("h3",{class:"text-red-400 font-semibold"},"Upload Error",-1)),e("p",Ie,i(a(l).error),1),e("button",{onClick:P,class:"btn-primary mt-2 text-sm"},"Try Again")])])])):_("",!0),a(y)&&a(o)?(u(),m("div",Le,[e("div",Ue,[g(a(E),{class:"w-8 h-8 animate-spin mx-auto mb-4 text-blue-400"}),t[14]||(t[14]=e("p",{class:"text-gray-400"},"Loading analysis data...",-1))])])):a(v)?(u(),m("div",Pe,[e("div",Me,[g(a(B),{class:"w-6 h-6 text-red-400"}),e("div",null,[t[15]||(t[15]=e("h3",{class:"text-red-400 font-semibold"},"Error Loading Data",-1)),e("p",ze,i(a(v)),1),e("button",{onClick:N,class:"btn-primary mt-2 text-sm"},"Retry")])])])):a(o)?(u(),m("div",Oe,[e("div",Te,[e("div",Ve,[e("div",He,[e("div",null,[t[16]||(t[16]=e("p",{class:"text-sm text-gray-400"},"Fraud Rate",-1)),e("p",Ge,i(C(a(o).fraud_statistics.fraud_percentage))+"%",1),e("p",We,i(a(o).fraud_statistics.fraud_cases)+" cases detected",1)]),e("div",Ze,[g(a(B),{class:"w-6 h-6 text-red-400"})])])]),e("div",Je,[e("div",qe,[e("div",null,[t[17]||(t[17]=e("p",{class:"text-sm text-gray-400"},"Total Transactions",-1)),e("p",Ke,i(k(a(o).fraud_statistics.total_transactions)),1),e("p",Qe,i(k(a(o).fraud_statistics.legitimate_transactions))+" legitimate",1)]),e("div",Xe,[g(a(ue),{class:"w-6 h-6 text-blue-400"})])])]),e("div",Ye,[e("div",et,[e("div",null,[t[18]||(t[18]=e("p",{class:"text-sm text-gray-400"},"High Risk Amount Range",-1)),t[19]||(t[19]=e("p",{class:"text-2xl font-bold text-yellow-400"},"$501-1000",-1)),e("p",tt,i(C(V("501-1000")))+"% fraud rate",1)]),e("div",st,[g(a(ge),{class:"w-6 h-6 text-yellow-400"})])])]),e("div",at,[e("div",rt,[e("div",null,[t[20]||(t[20]=e("p",{class:"text-sm text-gray-400"},"Detection Accuracy",-1)),e("p",ot,i(H())+"%",1),t[21]||(t[21]=e("p",{class:"text-xs text-green-400"},"System performance",-1))]),e("div",lt,[g(a(me),{class:"w-6 h-6 text-green-400"})])])])]),e("div",nt,[e("div",it,[t[22]||(t[22]=e("h3",{class:"text-lg font-semibold text-white mb-4"},"Fraud by Category",-1)),e("div",dt,[g(n,{data:a(K),type:"bar"},null,8,["data"])])]),e("div",ct,[t[23]||(t[23]=e("h3",{class:"text-lg font-semibold text-white mb-4"},"Fraud Rate by Amount Range",-1)),e("div",ut,[g(n,{data:a(Q),type:"line"},null,8,["data"])])]),e("div",mt,[t[24]||(t[24]=e("h3",{class:"text-lg font-semibold text-white mb-4"},"Fraud Distribution by Gender",-1)),e("div",gt,[g(n,{data:a(X),type:"doughnut"},null,8,["data"])])]),e("div",pt,[t[25]||(t[25]=e("h3",{class:"text-lg font-semibold text-white mb-4"},"Highest Risk Categories",-1)),e("div",ft,[(u(!0),m(j,null,$(a(M),r=>(u(),m("div",{key:r.name,class:"flex items-center"},[e("div",vt,i(I(r.name)),1),e("div",xt,[e("div",_t,[e("div",{class:"bg-gradient-to-r from-red-500 to-orange-500 h-3 rounded-full transition-all duration-500",style:T({width:r.fraud_rate/a(M)[0].fraud_rate*100+"%"})},null,4)])]),e("div",yt,i(C(r.fraud_rate*100))+"%",1)]))),128))])])]),e("div",bt,[e("div",ht,[t[26]||(t[26]=e("h3",{class:"text-lg font-semibold text-white mb-4"},"AI Insights",-1)),e("div",wt,[(u(!0),m(j,null,$(a(o).insights,(r,c)=>(u(),m("div",{key:c,class:"flex items-start space-x-3 p-3 bg-gray-700/30 rounded-lg"},[e("div",kt,[e("span",Ct,i(c+1),1)]),e("p",Ft,i(r),1)]))),128))])]),e("div",Nt,[t[27]||(t[27]=e("h3",{class:"text-lg font-semibold text-white mb-4"},"Amount Range Analysis",-1)),e("div",Dt,[(u(!0),m(j,null,$(a(o).trends.by_amount,(r,c)=>(u(),m("div",{key:c,class:"flex items-center justify-between p-3 bg-gray-700/30 rounded-lg"},[e("div",null,[e("div",Rt,"$"+i(c),1),e("div",jt,i(k(r.count))+" transactions",1)]),e("div",$t,[e("div",{class:R(["font-medium",L(r.mean*100)])},i(C(r.mean*100))+"% ",3),e("div",At,i(r.sum)+" fraud cases",1)])]))),128))])])]),e("div",St,[t[31]||(t[31]=e("h3",{class:"text-lg font-semibold text-white mb-4"},"Gender-Based Analysis",-1)),e("div",Bt,[(u(!0),m(j,null,$(a(o).trends.by_gender,(r,c)=>(u(),m("div",{key:c,class:"p-4 bg-gray-700/30 rounded-lg text-center"},[e("div",{class:R(["text-2xl font-bold mb-2",c==="F"?"text-pink-400":"text-blue-400"])},i(c==="F"?"Female":"Male"),3),e("div",Et,[e("div",null,[t[28]||(t[28]=e("div",{class:"text-gray-400"},"Transactions",-1)),e("div",It,i(k(r.count)),1)]),e("div",null,[t[29]||(t[29]=e("div",{class:"text-gray-400"},"Fraud Cases",-1)),e("div",Lt,i(r.sum),1)]),e("div",Ut,[t[30]||(t[30]=e("div",{class:"text-gray-400"},"Fraud Rate",-1)),e("div",{class:R(["font-semibold",L(r.mean*100)])},i(C(r.mean*100))+"% ",3)])])]))),128))])])])):_("",!0)])]),_:1})}}},Zt=se(Pt,[["__scopeId","data-v-d447831a"]]);export{Zt as default};
